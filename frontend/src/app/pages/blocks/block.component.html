<div #blockContainer class="block-container">
  <div
    *ngFor="let block of blocks"
    class="block"
    [id]="'block-' + block.id"
    [style.left.px]="block.position?.x"
    [style.top.px]="block.position?.y"
    [style.border]="'2px solid ' + getBlockBorderColor(block)"
  >
    <p><strong>Bloc {{ block.id }}</strong></p>
    <input
      type="text"
      class="command-input"
      [(ngModel)]="block.command"
      (keyup.enter)="handleCommandEnter(block)"
      placeholder="Entrez un prompt..."
    />

    <div class="section-header">
      <h4>Choix</h4>
      <button (click)="addChoice(block)">â•</button>
    </div>    
    <div
      *ngFor="let choice of block.choices; let i = index"
      class="choice"
      [id]="choice.id"
      style="position: relative;"
    >
      <label>
        {{ choice.label }}
      </label>
      <div class="choice-actions">
        <button class="link-btn" (click)="addBlockFromChoice(block.id, choice.id)">â•</button>
        <div class="settings-wrapper">
          <button class="settings-btn" (click)="toggleSettings(choice)">âš™ï¸</button>
          <div *ngIf="currentOpenChoiceId === choice.id" class="settings-panel">
            <button (click)="startEditingChoice(choice)">âœï¸ Modifier</button>
            <button (click)="removeChoice(block.id, choice.id)">ğŸ—‘ï¸ Supprimer</button>
          </div>
        </div>
      </div>
    </div>

    <div class="replies-section">
      <div class="replies-header">
        <strong>RÃ©pliques</strong>
        <button (click)="addReply(block)">â•</button>
      </div>
    
      <div *ngFor="let reply of block.replies" class="reply-line">
        <select [(ngModel)]="reply.character">
          <option>Personnage 1</option>
          <option>Personnage 2</option>
          <option>Personnage 3</option>
        </select>
    
        <input type="text" [(ngModel)]="reply.text" placeholder="Texte de la rÃ©plique..." />
    
        <select [(ngModel)]="reply.tone">
          <option>Neutre</option>
          <option>Ã‰motion</option>
          <option>ColÃ¨re</option>
          <option>Joie</option>
        </select>
    
        <button class="delete-btn" (click)="removeReply(block, reply.id)">ğŸ—‘ï¸</button>
      </div>
    </div>    
  </div>
</div>
