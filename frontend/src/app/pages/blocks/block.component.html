<div #blockContainer class="block-container">
  <div
    *ngFor="let block of blocks"
    class="block"
    [id]="'block-' + block.id"
    [style.left.px]="block.position?.x"
    [style.top.px]="block.position?.y"
    [style.border]="'2px solid ' + getBlockBorderColor(block)"
    (mousedown)="onMouseDown($event, block)"
  >
    <p><strong>Bloc {{ block.id }}</strong></p>
    <input
      type="text"
      class="command-input"
      [(ngModel)]="block.command"
      (keyup.enter)="handleCommandEnter(block)"
      placeholder="Entrez un prompt..."
    />

    <div class="section-header">
      <h4>Choix</h4>
      <button (click)="addChoice(block)">‚ûï</button>
    </div>    
    <div
      *ngFor="let choice of block.choices; let i = index"
      class="choice"
      [id]="choice.id"
      style="position: relative;"
    >
      <label *ngIf="!choice.editing">
        {{ choice.label }}
      </label>
      
      <input *ngIf="choice.editing"
            [(ngModel)]="choice.label"
            (blur)="stopEditingChoice(choice)"
            (keyup.enter)="stopEditingChoice(choice)"
            class="edit-choice-input"
      />
      <div class="choice-actions">
        <button class="link-btn" (click)="addBlockFromChoice(block.id, choice.id)">‚ûï</button>
        <div class="settings-wrapper">
          <button class="settings-btn" (click)="toggleSettings(choice)">‚öôÔ∏è</button>
          <div *ngIf="currentOpenChoiceId === choice.id" class="settings-panel">
            <button (click)="startEditingChoice(choice)">‚úèÔ∏è Modifier</button>
            <button (click)="removeChoice(block.id, choice.id)">üóëÔ∏è Supprimer</button>
          </div>
        </div>
      </div>
    </div>

    <div class="replies-section">
      <div class="replies-header">
        <strong>R√©pliques</strong>
        <button (click)="addNewReply(block)">‚ûï</button>
      </div>
    
      <div *ngFor="let reply of block.repliques" class="reply-line">
        <div class="reply-top">
          <select [(ngModel)]="reply.personnage">
            <option *ngFor="let personnage of personnages">
              {{ personnage }}
            </option>
          </select>
    
          <select [(ngModel)]="reply.emotion">
            <option>NEUTRAL</option>
            <option>ANGRY</option>
            <option>HAPPY</option>
            <option>SAD</option>
          </select>
    
          <button class="delete-btn" (click)="removeReply(block, reply)">üóëÔ∏è</button>
        </div>
    
        <textarea
          class="reply-text"
          [(ngModel)]="reply.texte"
          placeholder="Texte de la r√©plique..."
        ></textarea>
    
        <hr class="reply-separator" />
      </div>
    </div>   
    <div class="block-footer">
      <button class="submit-btn">Envoyer</button>
    </div>         
  </div>
</div>
